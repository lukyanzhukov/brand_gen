import OpenAI from 'openai'
import { ExtractedContent } from './extract'
import { ColorPalette } from './palette'

export interface PageBlock {
  type: string
  variant: string
  props: Record<string, any>
  imageSlots?: Array<{
    role: string
    required: boolean
    source?: string
  }>
}

export interface PageLayout {
  blocks: PageBlock[]
  metadata?: {
    title: string
    description: string
  }
}

export interface BlockCopy {
  [blockType: string]: {
    title?: string
    subtitle?: string
    content?: string
    bullets?: string[]
    captions?: string[]
    buttonText?: string
    [key: string]: any
  }
}

export interface UnifiedGenerationResult {
  layout: PageLayout
  copy: BlockCopy
}

function getOpenAIClient() {
  return new OpenAI({
    apiKey: process.env.OPENAI_API_KEY || process.env.AUTH_TOKEN,
    baseURL: process.env.BASE_URL || 'https://api.openai.com/v1',
  })
}

export async function generateUnifiedContent(
  companyData: any,
  colorPalette?: ColorPalette
): Promise<UnifiedGenerationResult> {
  
  try {
    const systemPrompt = `–°–æ–∑–¥–∞–π –±—Ä–µ–Ω–¥-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏ –í–°–ï 10 –±–ª–æ–∫–æ–≤ –≤ —ç—Ç–æ–º –ø–æ—Ä—è–¥–∫–µ:

1. hero - –≥–ª–∞–≤–Ω—ã–π –±–ª–æ–∫ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. about - –æ –∫–æ–º–ø–∞–Ω–∏–∏
3. tracks - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
4. geo - –≥–µ–æ–≥—Ä–∞—Ñ–∏—è
5. facts - —Ü–∏—Ñ—Ä—ã –∏ —Ñ–∞–∫—Ç—ã
6. benefits - –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã
7. culture - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–µ
8. media - —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π –∏ –º–µ–¥–∏–∞
9. hiring - —à–∞–≥–∏ –∫–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É
10. cta - –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–í–µ—Ä–Ω–∏ JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "layout": {
    "blocks": [
      {"type": "hero", "props": {"logoUrl": "https://img.hhcdn.ru/employer-logo-original/1439083.png"}, "imageSlots": []},
      {"type": "about", "props": {}, "imageSlots": []},
      {"type": "tracks", "props": {}, "imageSlots": []},
      {"type": "geo", "props": {}, "imageSlots": []},
      {"type": "facts", "props": {}, "imageSlots": []},
      {"type": "benefits", "props": {}, "imageSlots": []},
      {"type": "culture", "props": {}, "imageSlots": []},
      {"type": "media", "props": {}, "imageSlots": []},
      {"type": "hiring", "props": {}, "imageSlots": []},
      {"type": "cta", "props": {}, "imageSlots": []}
    ]
  },
  "copy": {
    "hero": {
      "title": "Heads&Hands",
      "subtitle": "–°–æ–∑–¥–∞–µ–º —Å—É–ø–µ—Ä–∞–ø–ø—ã –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ª–∏–¥–µ—Ä–æ–≤ —Ä—ã–Ω–∫–∞",
      "cta": "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏",
      "directions": [
        {"title": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å—É–ø–µ—Ä–∞–ø–ø–æ–≤", "description": "–°–æ–∑–¥–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è", "icon": "üì±"},
        {"title": "–¶–∏—Ñ—Ä–æ–≤—ã–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã", "description": "–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞", "icon": "üåê"},
        {"title": "–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏", "description": "–û—Ç –∏–¥–µ–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏", "icon": "‚ö°"}
      ]
    },
    "about": {
      "title": "–û –∫–æ–º–ø–∞–Ω–∏–∏",
      "content": "Heads&Hands ‚Äî –ª–∏–¥–µ—Ä –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —ç–∫–æ—Å–∏—Å—Ç–µ–º –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ç–∞–∫–∏–º–∏ –≥–∏–≥–∞–Ω—Ç–∞–º–∏, –∫–∞–∫ –¢-–±–∞–Ω–∫, LaModa –∏ –°–ø–æ—Ä—Ç–º–∞—Å—Ç–µ—Ä, —Å–æ–∑–¥–∞–≤–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
      "bullets": [
        "2 –º–µ—Å—Ç–æ –≤ –†–µ–π—Ç–∏–Ω–≥–µ –†—É–Ω–µ—Ç–∞ —Å—Ä–µ–¥–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞",
        "200+ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ",
        "13 –ª–µ—Ç —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä—ã–Ω–∫–µ"
      ],
      "achievements": [
        {"number": "200+", "label": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤", "description": "–í –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"},
        {"number": "13", "label": "–õ–µ—Ç –æ–ø—ã—Ç–∞", "description": "–ù–∞ —Ä—ã–Ω–∫–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"},
        {"number": "2", "label": "–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ", "description": "–°—Ä–µ–¥–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞"},
        {"number": "50+", "label": "–ü—Ä–æ–µ–∫—Ç–æ–≤", "description": "–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"}
      ]
    },
    "tracks": {
      "title": "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã",
      "tracks": [
        {"title": "–ú–æ–±–∏–ª—å–Ω–∞—è –∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "description": "iOS, Android, React Native, Flutter", "icon": "üì±", "examples": ["Swift", "Kotlin", "React Native", "Flutter"]},
        {"title": "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", "description": "Data Science, QA, Performance Testing", "icon": "üìä", "examples": ["Python", "Selenium", "JMeter", "Tableau"]},
        {"title": "UX/UI –¥–∏–∑–∞–π–Ω", "description": "User Experience, Interface Design, Prototyping", "icon": "üé®", "examples": ["Figma", "Sketch", "Adobe XD", "Principle"]}
      ]
    },
    "geo": {
      "title": "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è",
      "locations": [
        {"city": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "country": "–†–æ—Å—Å–∏—è", "type": "–ì–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å", "description": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ñ–∏—Å –∫–æ–º–ø–∞–Ω–∏–∏"},
        {"city": "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "country": "–†–æ—Å—Å–∏—è", "type": "–§–∏–ª–∏–∞–ª", "description": "–°–∏–±–∏—Ä—Å–∫–∏–π —Ñ–∏–ª–∏–∞–ª"},
        {"city": "–°–∞—Ä–∞–Ω—Å–∫", "country": "–†–æ—Å—Å–∏—è", "type": "–§–∏–ª–∏–∞–ª", "description": "–ü–æ–≤–æ–ª–∂—Å–∫–∏–π —Ñ–∏–ª–∏–∞–ª"},
        {"city": "–°–∞—Ä–∞—Ç–æ–≤", "country": "–†–æ—Å—Å–∏—è", "type": "–§–∏–ª–∏–∞–ª", "description": "–Æ–∂–Ω—ã–π —Ñ–∏–ª–∏–∞–ª"}
      ]
    },
    "facts": {
      "title": "–¶–∏—Ñ—Ä—ã –∏ —Ñ–∞–∫—Ç—ã",
      "facts": [
        {"number": "1.5-3 –≥–æ–¥–∞", "label": "–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–æ–≤", "description": "–í—Ä–µ–º—è –æ—Ç —Å—Ç–∞—Ä—Ç–∞ –¥–æ —Ä–µ–ª–∏–∑–∞"},
        {"number": "50+", "label": "–£—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤", "description": "–î–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞"},
        {"number": "100%", "label": "–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —Å –∫—Ä—É–ø–Ω—ã–º –±–∏–∑–Ω–µ—Å–æ–º", "description": "–§–æ–∫—É—Å –Ω–∞ enterprise-–∫–ª–∏–µ–Ω—Ç–∞—Ö"}
      ]
    },
    "benefits": {
      "title": "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã",
      "benefits": [
        {"title": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "description": "–†–∞–±–æ—Ç–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å—Ç–µ–∫–æ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "category": "career", "icon": "üöÄ"},
        {"title": "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã", "description": "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–µ–≥–∞—Å–∏-–ø—Ä–æ–µ–∫—Ç–æ–≤", "category": "career", "icon": "‚ú®"},
        {"title": "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", "description": "–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã", "category": "financial", "icon": "üíº"},
        {"title": "–ö–æ–º–∞–Ω–¥–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤", "description": "–†–∞–±–æ—Ç–∞ —Å –ª—É—á—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ –æ—Ç—Ä–∞—Å–ª–∏", "category": "social", "icon": "üë•"}
      ]
    },
    "culture": {
      "title": "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
      "items": [
        {"title": "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–æ–≤", "description": "–ö–æ–º–∞–Ω–¥–∞ –≤–µ–¥–µ—Ç –ø—Ä–æ–µ–∫—Ç —Å –Ω—É–ª—è –¥–æ —Ä–µ–ª–∏–∑–∞ –±–µ–∑ —Å–º–µ–Ω—ã —Å–æ—Å—Ç–∞–≤–∞", "icon": "üéØ"},
        {"title": "–ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ", "description": "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å –∫–∞–∂–¥—ã–π –∞—Å–ø–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏", "icon": "üîç"},
        {"title": "–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ", "description": "–§–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö", "icon": "‚≠ê"},
        {"title": "–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ", "description": "–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤–æ—Ä–∫—à–æ–ø—ã –∏ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏", "icon": "üìö"}
      ]
    },
    "media": {
      "title": "–°—Ç–∞—Ç—å–∏ –∏ –º–µ–¥–∏–∞",
      "articles": [
        {"title": "–ö–∞–∫ –º—ã —Å–æ–∑–¥–∞–µ–º —Å—É–ø–µ—Ä–∞–ø–ø—ã –¥–ª—è –¢-–±–∞–Ω–∫–∞", "description": "–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø–æ–¥—Ö–æ–¥–æ–≤", "url": "#", "type": "article"},
        {"title": "–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã Heads&Hands –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", "description": "–ù–∞—à–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã", "url": "#", "type": "article"},
        {"title": "–ò–Ω—Ç–µ—Ä–≤—å—é —Å –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–º–ø–∞–Ω–∏–∏", "description": "–ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –∫–æ–º–ø–∞–Ω–∏–∏", "url": "#", "type": "video"}
      ]
    },
    "hiring": {
      "title": "–ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É",
      "items": [
        {"title": "–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏", "description": "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∑—é–º–µ —á–µ—Ä–µ–∑ –Ω–∞—à —Å–∞–π—Ç –∏–ª–∏ HeadHunter", "duration": "5 –º–∏–Ω—É—Ç", "icon": "üìù"},
        {"title": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é", "description": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á", "duration": "1-2 —á–∞—Å–∞", "icon": "üíª"},
        {"title": "–í—Å—Ç—Ä–µ—á–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π", "description": "–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –±—É–¥—É—â–∏–º–∏ –∫–æ–ª–ª–µ–≥–∞–º–∏ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤", "duration": "1 —á–∞—Å", "icon": "üë•"},
        {"title": "–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ", "description": "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ —Ä–∞–±–æ—Ç–µ", "duration": "1-3 –¥–Ω—è", "icon": "‚úÖ"}
      ]
    },
    "cta": {
      "title": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º",
      "description": "–•–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –∫–æ–º–∞–Ω–¥—ã, —Å–æ–∑–¥–∞—é—â–µ–π –±—É–¥—É—â–µ–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π? –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –Ω–∞—à–∏–º–∏ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏ –∏ –ø–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É!",
      "buttonText": "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏",
      "buttonUrl": "https://hh.ru/employer/1439083"
    }
  }
}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•:
- hero.cta (–ù–ï buttonText)
- about.content (–ù–ï description) + bullets (–ù–ï achievements) + achievements –∫–∞–∫ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- facts.facts[].number (–ù–ï value) + description
- geo.locations[].country (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
- benefits.benefits[].category (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: 'financial' | 'social' | 'career')
- culture.items (–ù–ï culture) - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- media.articles[].description + type (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
- hiring.items (–ù–ï process) - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å title, description, duration, icon

–í–ê–ñ–ù–û: 
- –í–°–ï –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –æ–±—ä–µ–∫—Ç–µ "copy", –∞ –Ω–µ –≤ "props"
- –í hero –±–ª–æ–∫–µ –ª–æ–≥–æ—Ç–∏–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ props.logoUrl
- –í—Å–µ –º–∞—Å—Å–∏–≤—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3-5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –í—Å–µ —Ç–µ–∫—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏–Ω–∏–µ —Ü–≤–µ—Ç–∞, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –¥—Ä—É–≥–∞—è –ø–∞–ª–∏—Ç—Ä–∞
- –í –æ–ø–∏—Å–∞–Ω–∏—è—Ö –±–ª–æ–∫–æ–≤ —É–ø–æ–º–∏–Ω–∞–π —Ü–≤–µ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –ø–∞–ª–∏—Ç—Ä—ã
- –í—Å–µ —Ü–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –ø–∞–ª–∏—Ç—Ä–µ`

    const userPrompt = `–ö–æ–º–ø–∞–Ω–∏—è: ${companyData.name || 'Heads&Hands'}
–û–ø–∏—Å–∞–Ω–∏–µ: ${companyData.companyCorpus || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø–∞–Ω–∏–∏'}
–õ–æ–≥–æ—Ç–∏–ø: ${companyData.logoUrl || '–ù–µ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞'}

${colorPalette ? `–¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–°–ü–û–õ–¨–ó–£–ô –≠–¢–ò –¶–í–ï–¢–ê):
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç: ${colorPalette.primary}
- –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç: ${colorPalette.accent}
- –§–æ–Ω: ${colorPalette.background}
- –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å: ${colorPalette.surface}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: 
1. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç—Ç–∏ —Ü–≤–µ—Ç–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ!
2. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏–Ω–∏–µ —Ü–≤–µ—Ç–∞ (#2563eb, #3B82F6) –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –¥—Ä—É–≥–∞—è –ø–∞–ª–∏—Ç—Ä–∞!
3. –í—Å–µ —Ü–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –ø–∞–ª–∏—Ç—Ä–µ!
4. –í –æ–ø–∏—Å–∞–Ω–∏—è—Ö –±–ª–æ–∫–æ–≤ —É–ø–æ–º–∏–Ω–∞–π —Ü–≤–µ—Ç–∞ –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã!` : ''}

–°–æ–∑–¥–∞–π JSON —Å 10 –±–ª–æ–∫–∞–º–∏ –¥–ª—è –±—Ä–µ–Ω–¥-—Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ò—Å–ø–æ–ª—å–∑—É–π –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏.

–í–ê–ñ–ù–û: –í hero –±–ª–æ–∫–µ –ª–æ–≥–æ—Ç–∏–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ props.logoUrl, –∞ –Ω–µ –≤ props.logo!`

    const openai = getOpenAIClient()
    const completion = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userPrompt }
      ],
      temperature: 0.7,
      max_tokens: 8000,
    }, {
      timeout: 180000 // 3 –º–∏–Ω—É—Ç—ã —Ç–∞–π–º–∞—É—Ç
    })

    const rawOutput = completion.choices[0]?.message?.content || '{}'

    // –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
    let result: any
    let parseError: string | undefined

    try {
      const jsonMatch = rawOutput.match(/\{[\s\S]*\}/)
      if (!jsonMatch) {
        throw new Error('LLM –Ω–µ –≤–µ—Ä–Ω—É–ª –≤–∞–ª–∏–¥–Ω—ã–π JSON')
      }

      result = JSON.parse(jsonMatch[0])
    } catch (error) {
      parseError = error instanceof Error ? error.message : 'Unknown parsing error'
      console.error('JSON parsing error:', parseError)
      throw error
    }

    return result as UnifiedGenerationResult

  } catch (error) {
    console.error('LLM generation error:', error)
    throw error
  }
}